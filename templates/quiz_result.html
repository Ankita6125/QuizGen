{% extends "base.html" %}
{% load static %}

{% block title %}Quiz Result - QuizGen{% endblock %}

{% block content %}
  <main class="flex flex-col items-center px-6 py-12 space-y-8">

    <!-- Score Card -->
    <div class="w-full max-w-lg bg-white rounded-2xl shadow-lg p-10 text-center neon-card">
      <h1 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900">
        üéâ Quiz Completed
      </h1>

      <div class="mb-4">
        {% if score >= 80 %}
          <span class="inline-block px-6 py-3 rounded-full bg-green-100 text-green-700 text-xl font-bold shadow">
            Your Score: {{ score }}%
          </span>
        {% elif score >= 50 %}
          <span class="inline-block px-6 py-3 rounded-full bg-yellow-100 text-yellow-700 text-xl font-bold shadow">
            Your Score: {{ score }}%
          </span>
        {% else %}
          <span class="inline-block px-6 py-3 rounded-full bg-red-100 text-red-700 text-xl font-bold shadow">
            Your Score: {{ score }}%
          </span>
        {% endif %}
      </div>

      <p class="text-gray-700 mb-6">
        Correct Answers: <span class="font-semibold text-gray-900">{{ correct }}</span> / {{ total }}
      </p>

      <div class="flex justify-center gap-4 mb-6">
        <a href="{% url 'dashboard' %}" 
           class="px-6 py-3 rounded-lg bg-gray-400 hover:bg-gray-500 text-white font-semibold shadow transition">
          ‚¨Ö Back to Dashboard
        </a>
        <a href="{% url 'history' %}" 
           class="px-6 py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white font-semibold shadow transition">
          üìä View History
        </a>
      </div>

      <!-- Preview Toggle Button -->
      <button id="toggleReview" 
              class="px-6 py-3 rounded-lg bg-indigo-600 hover:bg-indigo-700 text-white font-semibold shadow transition">
        üìñ Show Answer Review
      </button>
    </div>

    <!-- Answer Review (Initially Hidden) -->
    <div id="reviewSection" class="w-full max-w-3xl bg-white rounded-2xl shadow-lg p-8 hidden">
      <h2 class="text-2xl font-bold mb-6 text-gray-900">üìñ Answer Review</h2>

      {% if results %}
        <div class="space-y-6">
          {% for item in results %}
            <div class="p-5 rounded-xl border shadow-sm">
              <!-- Question -->
              <p class="font-semibold text-gray-900 mb-4">Q{{ forloop.counter }}. {{ item.question }}</p>

              <!-- Options list -->
              <ul class="space-y-3">
                {% for key, val in item.options.items %}

                  {% if item.user == None and key == item.correct %}
                    <!-- User skipped question, show only correct option -->
                    <li class="flex items-start justify-between p-3 rounded-lg border border-green-300 bg-green-50">
                      <div><span class="font-semibold mr-2">{{ key }}.</span> {{ val }}</div>
                      <div class="text-sm font-semibold text-green-800 flex items-center gap-2">
                        ‚úÖ Correct Answer
                      </div>
                    </li>

                  {% elif key == item.correct and key == item.user %}
                    <!-- Correctly chosen -->
                    <li class="flex items-start justify-between p-3 rounded-lg border border-green-300 bg-green-50 shadow-md">
                      <div><span class="font-semibold mr-2">{{ key }}.</span> {{ val }}</div>
                      <div class="text-sm font-semibold text-green-800 flex items-center gap-2">
                        ‚úÖ Your Answer
                      </div>
                    </li>

                  {% elif key == item.correct %}
                    <!-- Correct option (user missed) -->
                    <li class="flex items-start justify-between p-3 rounded-lg border border-green-300 bg-green-50">
                      <div><span class="font-semibold mr-2">{{ key }}.</span> {{ val }}</div>
                      <div class="text-sm font-semibold text-green-800 flex items-center gap-2">
                        ‚úÖ Correct Answer
                      </div>
                    </li>

                  {% elif key == item.user %}
                    <!-- User chose wrong -->
                    <li class="flex items-start justify-between p-3 rounded-lg border border-red-300 bg-red-50">
                      <div><span class="font-semibold mr-2">{{ key }}.</span> {{ val }}</div>
                      <div class="text-sm font-semibold text-red-700 flex items-center gap-2">
                        ‚ùå Your Answer
                      </div>
                    </li>

                  {% else %}
                    <!-- Neutral option -->
                    <li class="p-3 rounded-lg border border-gray-200 bg-white">
                      <span class="font-semibold mr-2 text-gray-700">{{ key }}.</span> {{ val }}
                    </li>
                  {% endif %}

                {% endfor %}
              </ul>

              <!-- Summary line under options -->
              <div class="mt-3 text-sm text-gray-700">
                {% if item.user == None %}
                  <span class="font-semibold text-red-700">‚ùå No Answer Selected</span>
                  <span class="mx-2">|</span>
                  <span class="font-semibold text-green-800">Correct Answer: {{ item.correct }}</span>
                {% elif item.is_correct %}
                  <span class="font-semibold text-green-800">Your Answer: {{ item.user }} (Correct)</span>
                {% else %}
                  <span class="font-semibold text-red-700">Your Answer: {{ item.user }} (Wrong)</span>
                  <span class="mx-2">|</span>
                  <span class="font-semibold text-green-800">Correct Answer: {{ item.correct }}</span>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-600">No review available. (Ensure results are passed from the view.)</p>
      {% endif %}
    </div>
  </main>

  <style>
    .neon-card {
      border: 2px solid rgba(99, 102, 241, 0.8);
      box-shadow: 0 0 15px rgba(99, 102, 241, 0.12),
                  0 0 30px rgba(99, 102, 241, 0.06);
      transition: box-shadow 0.25s ease-in-out;
    }
    .neon-card:hover {
      box-shadow: 0 0 25px rgba(99, 102, 241, 0.16),
                  0 0 50px rgba(99, 102, 241, 0.08);
    }
  </style>

  <script>
    // Toggle Answer Review visibility
    document.getElementById("toggleReview").addEventListener("click", function () {
      const review = document.getElementById("reviewSection");
      review.classList.toggle("hidden");
      this.textContent = review.classList.contains("hidden")
        ? "üìñ Show Answer Review"
        : "üìñ Hide Answer Review";
    });
  </script>
{% endblock %}
